<!-- Animated Search Component with Categories -->
<div class="relative flex-1 max-w-md mx-auto">
  <!-- Search Input -->
  <div class="relative">
    <input 
      type="text" 
      id="searchInput"
      placeholder="Search products, categories..." 
      class="w-full bg-gray-900 bg-opacity-80 border border-gray-700 rounded-full px-6 py-3 pl-12 text-white placeholder-gray-400 focus:outline-none focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 transition-all duration-300"
      autocomplete="off"
    >
    <div class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400">
      <i class="fas fa-search text-sm"></i>
    </div>
    <button 
      id="clearSearch"
      class="absolute right-4 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-white transition-colors duration-200 opacity-0 invisible"
      type="button"
    >
      <i class="fas fa-times text-sm"></i>
    </button>
  </div>

  <!-- Search Dropdown -->
  <div 
    id="searchDropdown" 
    class="absolute top-full left-0 right-0 mt-2 bg-black bg-opacity-95 backdrop-blur-md border border-gray-700 rounded-lg shadow-2xl opacity-0 invisible transform translate-y-2 transition-all duration-300 z-50 max-h-96 overflow-y-auto"
  >
    <!-- Quick Categories Section -->
    <div class="px-4 py-3 border-b border-gray-700">
      <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Browse Categories</h3>
      <div class="grid grid-cols-1 gap-1">
        {% for collection in collections limit: 6 %}
          {% unless collection.handle == 'frontpage' or collection.handle == 'all' %}
            <a 
              href="{{ collection.url }}" 
              class="flex items-center justify-between px-3 py-2 rounded-md hover:bg-cyan-400/10 hover:text-cyan-400 text-white transition-all duration-200 group"
            >
              <div class="flex items-center space-x-3">
                <div class="w-6 h-6 rounded-full bg-gradient-to-br from-cyan-400 to-blue-500 flex items-center justify-center">
                  <i class="fas fa-{{ collection.metafields.custom.icon | default: 'th-large' }} text-xs text-white"></i>
                </div>
                <span class="font-medium">{{ collection.title }}</span>
              </div>
              <div class="flex items-center space-x-2 text-xs text-gray-400 group-hover:text-cyan-300">
                <span>{{ collection.products_count }}</span>
                <i class="fas fa-arrow-right opacity-0 group-hover:opacity-100 transform translate-x-1 group-hover:translate-x-0 transition-all duration-200"></i>
              </div>
            </a>
          {% endunless %}
        {% endfor %}
      </div>
    </div>

    <!-- Search Results Section -->
    <div id="searchResults" class="px-4 py-3">
      <!-- This will be populated by JavaScript -->
    </div>

    <!-- Popular Searches / Quick Actions -->
    <div class="px-4 py-3 border-t border-gray-700">
      <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Quick Links</h3>
      <div class="grid grid-cols-2 gap-2">
        <a href="{{ collections.all.url }}" class="flex items-center space-x-2 px-3 py-2 rounded-md hover:bg-gray-800 text-gray-300 hover:text-white transition-colors duration-200">
          <i class="fas fa-th text-xs"></i>
          <span class="text-sm">All Products</span>
        </a>
        <a href="{{ collections.featured.url | default: collections.all.url }}" class="flex items-center space-x-2 px-3 py-2 rounded-md hover:bg-gray-800 text-gray-300 hover:text-white transition-colors duration-200">
          <i class="fas fa-star text-xs"></i>
          <span class="text-sm">Featured</span>
        </a>
        {% if collections.sale %}
        <a href="{{ collections.sale.url }}" class="flex items-center space-x-2 px-3 py-2 rounded-md hover:bg-red-900/20 hover:bg-red-500/10 text-gray-300 hover:text-red-400 transition-colors duration-200">
          <i class="fas fa-tag text-xs"></i>
          <span class="text-sm">Sale Items</span>
        </a>
        {% endif %}
        {% if collections.new %}
        <a href="{{ collections.new.url }}" class="flex items-center space-x-2 px-3 py-2 rounded-md hover:bg-green-900/20 hover:bg-green-500/10 text-gray-300 hover:text-green-400 transition-colors duration-200">
          <i class="fas fa-sparkles text-xs"></i>
          <span class="text-sm">New Arrivals</span>
        </a>
        {% endif %}
      </div>
    </div>
  </div>
</div>

<!-- Search Overlay (for mobile) -->
<div id="searchOverlay" class="fixed inset-0 bg-black bg-opacity-50 backdrop-blur-sm opacity-0 invisible transition-all duration-300 z-40"></div>

<style>
/* Custom scrollbar for search dropdown */
#searchDropdown {
  scrollbar-width: thin;
  scrollbar-color: #00FFFF #1F2937;
}

#searchDropdown::-webkit-scrollbar {
  width: 6px;
}

#searchDropdown::-webkit-scrollbar-track {
  background: #1F2937;
}

#searchDropdown::-webkit-scrollbar-thumb {
  background-color: #00FFFF;
  border-radius: 3px;
}

/* Smooth animations */
.search-result-item {
  animation: fadeInUp 0.2s ease-out;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

/* Focus states */
#searchInput:focus + .absolute + #searchDropdown {
  opacity: 1;
  visibility: visible;
  transform: translateY(0);
}

/* Mobile responsive adjustments */
@media (max-width: 640px) {
  #searchDropdown {
    left: -1rem;
    right: -1rem;
    max-height: 70vh;
  }
  
  .grid-cols-2 {
    grid-template-columns: 1fr;
  }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('searchInput');
  const searchDropdown = document.getElementById('searchDropdown');
  const searchResults = document.getElementById('searchResults');
  const clearSearch = document.getElementById('clearSearch');
  const searchOverlay = document.getElementById('searchOverlay');
  let searchTimeout;

  // Sample product data - In a real Shopify theme, this would come from a Liquid template or API
  const sampleProducts = [
    {% for product in collections.all.products limit: 20 %}
    {
      title: {{ product.title | json }},
      handle: {{ product.handle | json }},
      url: {{ product.url | json }},
      price: {{ product.price | money | json }},
      image: {{ product.featured_media | image_url: width: 100 | json }},
      vendor: {{ product.vendor | json }},
      type: {{ product.type | json }}
    },
    {% endfor %}
  ];

  // Show dropdown on input focus
  searchInput.addEventListener('focus', function() {
    showDropdown();
  });

  // Handle input changes
  searchInput.addEventListener('input', function() {
    const query = this.value.trim();
    
    if (query.length > 0) {
      clearSearch.classList.remove('opacity-0', 'invisible');
      clearTimeout(searchTimeout);
      searchTimeout = setTimeout(() => {
        performSearch(query);
      }, 300);
    } else {
      clearSearch.classList.add('opacity-0', 'invisible');
      clearSearchResults();
    }
  });

  // Clear search functionality
  clearSearch.addEventListener('click', function() {
    searchInput.value = '';
    clearSearch.classList.add('opacity-0', 'invisible');
    clearSearchResults();
    searchInput.focus();
  });

  // Hide dropdown when clicking outside
  document.addEventListener('click', function(e) {
    if (!searchInput.contains(e.target) && !searchDropdown.contains(e.target)) {
      hideDropdown();
    }
  });

  // Hide dropdown on escape key
  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      hideDropdown();
      searchInput.blur();
    }
  });

  function showDropdown() {
    searchDropdown.classList.remove('opacity-0', 'invisible', 'translate-y-2');
    searchDropdown.classList.add('opacity-100', 'visible', 'translate-y-0');
    searchOverlay.classList.remove('opacity-0', 'invisible');
    searchOverlay.classList.add('opacity-100', 'visible');
  }

  function hideDropdown() {
    searchDropdown.classList.remove('opacity-100', 'visible', 'translate-y-0');
    searchDropdown.classList.add('opacity-0', 'invisible', 'translate-y-2');
    searchOverlay.classList.remove('opacity-100', 'visible');
    searchOverlay.classList.add('opacity-0', 'invisible');
  }

  function performSearch(query) {
    const results = sampleProducts.filter(product => 
      product.title.toLowerCase().includes(query.toLowerCase()) ||
      product.vendor.toLowerCase().includes(query.toLowerCase()) ||
      product.type.toLowerCase().includes(query.toLowerCase())
    ).slice(0, 5);

    displaySearchResults(results, query);
  }

  function displaySearchResults(results, query) {
    if (results.length === 0) {
      searchResults.innerHTML = `
        <div class="text-center py-8">
          <i class="fas fa-search text-gray-500 text-2xl mb-3"></i>
          <p class="text-gray-400">No products found for "${query}"</p>
          <a href="/search?q=${encodeURIComponent(query)}" class="text-cyan-400 hover:text-cyan-300 text-sm mt-2 inline-block">
            View all search results →
          </a>
        </div>
      `;
      return;
    }

    const resultsHTML = `
      <h3 class="text-xs font-semibold text-gray-400 uppercase tracking-wider mb-2">Search Results</h3>
      <div class="space-y-1">
        ${results.map(product => `
          <a href="${product.url}" class="search-result-item flex items-center space-x-3 px-3 py-3 rounded-md hover:bg-gray-800 text-white transition-all duration-200 group">
            ${product.image ? `
              <img src="${product.image}" alt="${product.title}" class="w-10 h-10 object-cover rounded-md">
            ` : `
              <div class="w-10 h-10 bg-gray-700 rounded-md flex items-center justify-center">
                <i class="fas fa-cube text-gray-500 text-xs"></i>
              </div>
            `}
            <div class="flex-1 min-w-0">
              <p class="font-medium text-sm truncate group-hover:text-cyan-400">${product.title}</p>
              <p class="text-xs text-gray-400">${product.vendor} • ${product.price}</p>
            </div>
            <i class="fas fa-arrow-right text-xs text-gray-500 group-hover:text-cyan-400 opacity-0 group-hover:opacity-100 transform translate-x-1 group-hover:translate-x-0 transition-all duration-200"></i>
          </a>
        `).join('')}
      </div>
      ${results.length >= 5 ? `
        <div class="mt-3 pt-3 border-t border-gray-700">
          <a href="/search?q=${encodeURIComponent(query)}" class="block text-center text-cyan-400 hover:text-cyan-300 text-sm font-medium">
            View all results for "${query}" →
          </a>
        </div>
      ` : ''}
    `;

    searchResults.innerHTML = resultsHTML;
  }

  function clearSearchResults() {
    searchResults.innerHTML = '';
  }

  // Handle search overlay click
  searchOverlay.addEventListener('click', function() {
    hideDropdown();
  });
});
</script>